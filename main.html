<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Main</title>
  <style>
    .scroll {
      width: 20px;
      height: 200px;
      overflow: auto;
      float: left;
      margin: 0 10px;
    }

    .scroll::-webkit-scrollbar {
      width: 10px;
    }

    .scroll::-webkit-scrollbar-thumb {
      background: #5F49AD;
      border-radius: 5px;
    }

    .scroll::-webkit-scrollbar-track {
      background: #fff;
      border-radius: 5px;
    }

    html {
      width: 100%;
      height: 100%;
    }

    body {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      margin: 0;
      padding: 0;
      background-image: url('./assets/background.png');
      background-repeat: no-repeat;
      background-size: 100%;
      background-color: #5F49AD;
    }

    #app {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .content {
      width: 100%;
      height: 90%;
      padding: 0;
      margin-top: 20px;
      box-sizing: border-box;
      overflow-y: visible;
      overflow-x: hidden;
    }

    .footer {
      width: 100%;
      height: 10%;
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      align-items: center;
    }

    .btn {
      border: 0;
      border-radius: 4px;
      height: 28px;
      padding: 0 20px;
      font-size: 12px;
      background: #DDD;
      color: #000;
      cursor: pointer;
    }

    .btn.red {
      background: #DF4723;
      color: #fff;
    }

    .btn.blue {
      background: #1B6A8D;
      color: #fff;
    }

    .btn.transparent {
      background: transparent;
      color: #fff;
    }

    ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    ul li {
      padding: 0;
      margin-top: 5px;
      margin-bottom: 15px;
      margin-right: 20px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }

    ul li .project {
      font-size: 16px;
      text-align: left;
      height: auto;
      line-height: 16px;
    }

    ul li .project span {
      font-size: 10px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<body>
  <div id="app">

    <div class="content scroll">
      <ul class="">
        <li v-for="project in projectsList">
          <button class="btn transparent project" v-on:click="openProject(project)">
            {{ project.name }} <br>
            <span>{{ project.path }}</span>
          </button>
          <button class="btn red" v-on:click="removeProject(project)">{{remove}}</button>
        </li>
      </ul>
    </div>

    <div class="footer">
      <button class="btn blue" v-on:click="addProject">{{add}}</button>
      <button class="btn red" v-on:click="quitApp">{{close}}</button>
    </div>

  </div>

  <script>
    const electron = require('electron');
    const fs = require('fs');
    const { resolve, basename } = require('path');
    const { spawn } = require('child_process');
    const { remote } = electron;
    const { dialog } = remote;
    const fixPath = require('fix-path');
    fixPath();

    const schema = {
      projects: {
        type: 'string',
      },
    };

    const Store = require('electron-store');
    const store = new Store({ schema });
    const storedProjects = store.get('projects');

    function getLocale() {
      const locale = remote.app.getLocale();

      switch (locale) {
        case 'es-419' || 'es':
          return JSON.parse(fs.readFileSync(resolve(__dirname, 'locale/es.json')));
        case 'pt-BR' || 'pt-PT':
          return JSON.parse(fs.readFileSync(resolve(__dirname, 'locale/pt.json')));
        default:
          return JSON.parse(fs.readFileSync(resolve(__dirname, 'locale/en.json')));
      }
    }

    const app = new Vue({
      el: '#app',
      data: {
        add: getLocale().add,
        close: getLocale().close,
        remove: getLocale().remove,
        projectsList: storedProjects ? JSON.parse(storedProjects) : [],
      },
      methods: {
        quitApp: function () {
          remote.app.quit();
        },
        addProject: async function () {
          const result = await dialog.showOpenDialog({ properties: ['openDirectory', 'multiSelections'], });
          if (result.canceled) return;
          result.filePaths.forEach(path => {
            const name = basename(path);
            this.projectsList = [
              ...this.projectsList,
              {
                path,
                name,
              },
            ]
          });
          store.set(
            'projects',
            JSON.stringify(this.projectsList),
          );
        },
        removeProject: async function (project) {
          const index = this.projectsList.indexOf(project);
          if (index > -1) {
            this.projectsList.splice(index, 1);
          }
          store.set(
            'projects',
            JSON.stringify(this.projectsList),
          );
        },
        openProject: async function (project) {
          spawn('code', [project.path], { shell: true });
          remote.getCurrentWindow().hide();
        },
      }
    })
  </script>
</body>

</html>
